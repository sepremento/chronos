# Chronos

Простой тайм-трекер для учёта времени и задач. Предназначен для расширения на
различные интерфейсы. Код находится в `src/chronologger.py`. Файл `chronos`
содержит pyrogram-приложение для взаимодействия с API Telegram.

Установка `pyrogram`:

```
pip install pyrogram
```

Настройка параметров для работы приложения описана в разделе [Quick
Start](https://docs.pyrogram.org/intro/quickstart) документации pyrogram. Для
работы нужно получить секреты `API_ID` и `API_HASH`


Секреты подтягиваются из переменных окружения `TELEGRAM_API_ID` и
`TELEGRAM_API_HASH`. 

## Команды Chronos в Telegram
Допустимо добавлять одновременно три задачи для отслеживания. Нумерация задач
ведётся от нуля.

- `.[описание].[тег[,тег[, ...]]][. время_начала (ЧЧ:ММ)][. время_завершения (ЧЧ:ММ)]` -
добавление задачи. Между точками может быть произвольное количество пробельных
символов. Внутри описания точки недопустимы и будут интерпретированы как
разделители.
- `. у [номер задачи]` - удалить задачу. Если номер не задан, то подразумевается
    нулевая задача.
- `. с [номер задачи]` - остановить (стоп) отслеживание и зафиксировать задачу.
    Если номер задачи не задан, то подразумевается нулевая задача.
- `. тд [номер задачи] тег` - добавить тег к задаче с указанным номером. Если
    номер не задан, то подразумевается нулевая задача.
- `. ту [номер задачи] тег` - удалить тег у задачи с указанным номером. Если
    номер не задан, то подразумевается нулевая задача.
- `. о [номер задачи] описание` - изменить описание у задачи с указанным
    номером. Если номер не задан, то подразумевается нулевая задача.
- `. в [номер задачи] [время_начала (ЧЧ:ММ)][, время_завершения (ЧЧ:ММ)]` - изменить время
    начала и/или завершения задачи с указанным номером. Если номер не указан, то
    подразумевается нулевая задача.


## Оформление в виде сервиса

Секреты можно прописать в файле в формате `key=value`, а затем прописать
следующую службу systemd в директории `/etc/systemd/system/`:

```
[Unit]
Description=Chronometer for daily tasks
After=multi-user.target

[Service]
Type=simple
Restart=always
EnvironmentFile=<<путь до файла с секретами>>
ExecStart=<<путь до исполняемого файла chronos>>

[Install]
WantedBy=multi-user.target
```

Затем запустить только что созданную службу `chronos`

```bash
sudo systemctl daemon-reload
sudo systemctl start chronos.service
sudo systemctl status chronos.service  # проверяем, что запустилось
```

Для контроля за работой программы можно смотреть журналы systemd:

```bash
journalctl -u chronos.service -f
```
